<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>S√°ch N√≥i C√° Nh√¢n - Web Player</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { color: #007aff; text-align: center; margin-bottom: 20px; }
        #filePicker { display: block; width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; }
        #audioPlayer { width: 100%; margin-bottom: 20px; }
        #currentSong { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; text-align: center; }
        #playlist { list-style: none; padding: 0; border-top: 1px solid #eee; }
        #playlist li { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; transition: background-color 0.3s; }
        #playlist li:hover { background-color: #e9e9e9; }
        .playing { background-color: #d1e7ff; color: #007aff; font-weight: bold; }
        .instructions { background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #ffeeba; }
    </style>
</head>
<body>

<div class="container">
    <h1>üéß Tr√¨nh Nghe S√°ch C√° Nh√¢n</h1>
    
    <div class="instructions">
        <strong>H∆∞·ªõng d·∫´n:</strong> Nh·∫•n "Choose Files", ch·ªçn th∆∞ m·ª•c b·∫°n ƒë√£ l∆∞u MP3 trong ·ª©ng d·ª•ng Files (ho·∫∑c ch·ªçn t·ª´ng file).
    </div>

    <input type="file" id="filePicker" multiple accept=".mp3,audio/*">
    
    <div id="currentSong">Ch∆∞a ch·ªçn s√°ch n√≥i.</div>
    
    <audio id="audioPlayer" controls></audio>
    
    <h2>Danh s√°ch ph√°t:</h2>
    <ul id="playlist">
        </ul>
</div>

<script>
    const filePicker = document.getElementById('filePicker');
    const audioPlayer = document.getElementById('audioPlayer');
    const playlist = document.getElementById('playlist');
    const currentSongDisplay = document.getElementById('currentSong');
    
    let audioFiles = [];
    let currentTrackIndex = -1;

    // --- X·ª≠ l√Ω ch·ªçn File ---
    filePicker.addEventListener('change', (event) => {
        // L·∫•y t·∫•t c·∫£ c√°c file ƒë√£ ch·ªçn
        audioFiles = Array.from(event.target.files).filter(file => file.type.startsWith('audio/'));
        
        if (audioFiles.length === 0) {
            playlist.innerHTML = '<li>Kh√¥ng t√¨m th·∫•y file MP3 n√†o h·ª£p l·ªá.</li>';
            currentSongDisplay.textContent = 'Ch∆∞a ch·ªçn s√°ch n√≥i.';
            return;
        }

        // S·∫Øp x·∫øp theo t√™n file (gi·∫£ ƒë·ªãnh t√™n file l√† 1.mp3, 2.mp3,...)
        audioFiles.sort((a, b) => a.name.localeCompare(b.name, undefined, { numeric: true, sensitivity: 'base' }));

        // X√¢y d·ª±ng danh s√°ch ph√°t
        buildPlaylist();
        // B·∫Øt ƒë·∫ßu ph√°t b√†i ƒë·∫ßu ti√™n
        playTrack(0);
    });

    // --- X√¢y d·ª±ng Playlist ---
    function buildPlaylist() {
        playlist.innerHTML = ''; // X√≥a danh s√°ch c≈©
        audioFiles.forEach((file, index) => {
            const listItem = document.createElement('li');
            listItem.textContent = `${index + 1}. ${file.name.replace('.mp3', '')}`;
            listItem.dataset.index = index;
            listItem.addEventListener('click', () => {
                playTrack(index);
            });
            playlist.appendChild(listItem);
        });
    }

    // --- Logic Ph√°t nh·∫°c ---
    function playTrack(index) {
        if (index < 0 || index >= audioFiles.length) {
            return;
        }

        currentTrackIndex = index;
        const file = audioFiles[index];
        
        // 1. T·∫°o URL c·ª•c b·ªô t·ª´ File ƒë√£ ch·ªçn
        const fileURL = URL.createObjectURL(file);
        
        // 2. C·∫≠p nh·∫≠t tr√¨nh ph√°t
        audioPlayer.src = fileURL;
        audioPlayer.play();

        // 3. C·∫≠p nh·∫≠t giao di·ªán
        currentSongDisplay.textContent = `ƒêang Ph√°t: ${file.name}`;
        highlightCurrentTrack();
    }

    // --- ƒê√°nh d·∫•u b√†i ƒëang ph√°t ---
    function highlightCurrentTrack() {
        // X√≥a highlight c≈©
        playlist.querySelectorAll('li').forEach(li => li.classList.remove('playing'));
        
        // Th√™m highlight m·ªõi
        const currentItem = playlist.querySelector(`li[data-index="${currentTrackIndex}"]`);
        if (currentItem) {
            currentItem.classList.add('playing');
            // Cu·ªôn ƒë·∫øn b√†i h√°t ƒëang ph√°t (t√πy ch·ªçn)
            currentItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    }

    // --- T·ª± ƒë·ªông chuy·ªÉn b√†i khi h·∫øt b√†i ---
    audioPlayer.addEventListener('ended', () => {
        if (currentTrackIndex < audioFiles.length - 1) {
            playTrack(currentTrackIndex + 1); // Ph√°t b√†i ti·∫øp theo
        } else {
            // H·∫øt danh s√°ch
            currentSongDisplay.textContent = "ƒê√£ ph√°t h·∫øt danh s√°ch.";
            audioPlayer.pause();
            currentTrackIndex = -1;
            highlightCurrentTrack();
        }
    });

    // NgƒÉn ch·∫∑n s·ª± c·ªë r√≤ r·ªâ b·ªô nh·ªõ khi t·∫°o URL ƒë·ªëi t∆∞·ª£ng
    audioPlayer.addEventListener('loadedmetadata', () => {
        // Gi·∫£i ph√≥ng URL c≈©
        if (audioPlayer.previousObjectURL) {
            URL.revokeObjectURL(audioPlayer.previousObjectURL);
        }
        audioPlayer.previousObjectURL = audioPlayer.src;
    });

</script>

</body>
</html>
