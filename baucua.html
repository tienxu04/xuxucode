<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫ßu Cua Online - AI Edition</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        .shake-anim { animation: shake 0.5s infinite; }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            100% { transform: translate(1px, 1px) rotate(0deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-800 via-green-700 to-green-900 min-h-screen p-4 font-sans">

<div id="app" class="max-w-7xl mx-auto">
    <div v-if="toast" :class="toastClass" class="fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-xs animate__animated animate__fadeInRight">
        <div class="whitespace-pre-line text-sm font-bold">{{ toast.message }}</div>
    </div>

    <div class="text-center mb-6">
        <div class="inline-block bg-red-700 text-white px-6 py-3 rounded-lg shadow-lg mb-4">
            <div class="flex items-center gap-3">
                <span class="text-3xl">üé∞</span>
                <div class="text-left">
                    <div class="font-bold text-lg">NH√Ä C√ÅI</div>
                    <div class="text-xs opacity-80">Bot Dealer</div>
                </div>
            </div>
        </div>

        <div class="block">
            <div :class="{'shake-anim': isShaking}" class="bg-red-900 rounded-xl p-6 inline-flex gap-4 shadow-2xl border-4 border-yellow-600">
                <template v-if="gamePhase === 'betting' || gamePhase === 'shaking'">
                    <div v-for="i in 3" class="w-16 h-16 bg-white rounded-lg flex items-center justify-center shadow-inner">
                        <span class="text-3xl text-red-700">üé≤</span>
                    </div>
                </template>
                <template v-else>
                    <div v-for="res in diceResults" class="w-16 h-16 bg-white rounded-lg flex items-center justify-center text-4xl shadow-lg animate__animated animate__bounceIn">
                        {{ res.emoji }}
                    </div>
                </template>
            </div>
            <div v-if="isShaking" class="text-yellow-300 font-bold mt-2 animate-pulse">ƒêang l·∫Øc...</div>
        </div>
    </div>

    <div class="grid grid-cols-12 gap-4">
        <div class="col-span-12 md:col-span-2">
            <div class="bg-blue-800 text-white p-4 rounded-xl shadow-lg border border-blue-400">
                <div class="text-center mb-3">
                    <div class="text-3xl">ü§ñ</div>
                    <div class="font-bold">AI Player 1</div>
                    <div class="text-yellow-400 font-mono">{{ formatMoney(ai1Balance) }}</div>
                </div>
                <div class="space-y-1">
                    <div v-for="(amount, id) in ai1Bets" class="bg-blue-700 p-2 rounded text-xs flex justify-between">
                        <span>{{ getAnimal(id).emoji }} {{ getAnimal(id).name }}</span>
                        <span class="text-yellow-300 font-bold">{{ formatMoney(amount) }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-span-12 md:col-span-8">
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <button v-for="item in animals" 
                    @click="placeBet(item.id)"
                    :disabled="gamePhase !== 'betting'"
                    :class="[item.color, 'p-4 md:p-6 rounded-2xl shadow-xl transition-all hover:scale-105 active:scale-95 border-4 border-white flex flex-col items-center relative overflow-hidden disabled:opacity-70']">
                    <span class="text-5xl md:text-7xl mb-2">{{ item.emoji }}</span>
                    <span class="font-black text-xl md:text-2xl uppercase text-gray-800">{{ item.name }}</span>
                    
                    <div v-if="bets[item.id]" class="mt-2 bg-yellow-400 text-red-700 font-black py-1 px-4 rounded-full shadow-md animate__animated animate__pulse">
                        {{ formatMoney(bets[item.id]) }}
                    </div>
                </button>
            </div>
        </div>

        <div class="col-span-12 md:col-span-2">
            <div class="bg-purple-800 text-white p-4 rounded-xl shadow-lg border border-purple-400">
                <div class="text-center mb-3">
                    <div class="text-3xl">ü§ñ</div>
                    <div class="font-bold">AI Player 2</div>
                    <div class="text-yellow-400 font-mono">{{ formatMoney(ai2Balance) }}</div>
                </div>
                <div class="space-y-1">
                    <div v-for="(amount, id) in ai2Bets" class="bg-purple-700 p-2 rounded text-xs flex justify-between">
                        <span>{{ getAnimal(id).emoji }} {{ getAnimal(id).name }}</span>
                        <span class="text-yellow-300 font-bold">{{ formatMoney(amount) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-8 bg-gradient-to-r from-yellow-500 to-yellow-600 p-6 rounded-2xl shadow-2xl border-t-4 border-yellow-300">
        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="text-white text-center md:text-left">
                <div class="uppercase text-xs font-bold opacity-80 tracking-widest">T√†i kho·∫£n c·ªßa b·∫°n</div>
                <div class="text-4xl font-black drop-shadow-md">{{ formatMoney(balance) }}</div>
                <div v-if="totalBet > 0" class="bg-black/20 rounded px-2 mt-1 inline-block">ƒê√£ c∆∞·ª£c: {{ formatMoney(totalBet) }}</div>
            </div>
            
            <div class="flex gap-4">
                <button @click="resetBets" 
                    :disabled="gamePhase !== 'betting' || totalBet === 0"
                    class="bg-gray-700 hover:bg-gray-800 text-white px-6 py-4 rounded-xl font-bold transition-all disabled:opacity-50">
                    H·ªßy c∆∞·ª£c
                </button>
                <button @click="rollDice" 
                    :disabled="gamePhase !== 'betting' || totalBet === 0"
                    class="bg-red-600 hover:bg-red-700 text-white px-12 py-4 rounded-xl font-black text-2xl shadow-lg transition-all transform active:translate-y-1 disabled:bg-gray-500">
                    KHUI üé≤
                </button>
            </div>
        </div>
    </div>

    <div class="mt-6 text-center text-white/50 text-sm italic">
        * Nh·∫•n v√†o √¥ linh v·∫≠t ƒë·ªÉ ƒë·∫∑t c∆∞·ª£c (5.000ƒë/l·∫ßn)
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue;

    createApp({
        setup() {
            const animals = [
                { id: 'bau', name: 'B·∫ßu', emoji: 'üéÉ', color: 'bg-orange-100' },
                { id: 'cua', name: 'Cua', emoji: 'ü¶Ä', color: 'bg-red-100' },
                { id: 'tom', name: 'T√¥m', emoji: 'ü¶ê', color: 'bg-pink-100' },
                { id: 'ca', name: 'C√°', emoji: 'üêü', color: 'bg-blue-100' },
                { id: 'ga', name: 'G√†', emoji: 'üêì', color: 'bg-yellow-100' },
                { id: 'nai', name: 'Nai', emoji: 'ü¶å', color: 'bg-green-100' }
            ];

            const balance = ref(100000);
            const ai1Balance = ref(100000);
            const ai2Balance = ref(100000);
            const bets = ref({});
            const ai1Bets = ref({});
            const ai2Bets = ref({});
            const diceResults = ref([]);
            const isShaking = ref(false);
            const gamePhase = ref('betting');
            const toast = ref(null);
            const betUnit = 5000;

            const formatMoney = (val) => val.toLocaleString('vi-VN') + 'ƒë';
            const getAnimal = (id) => animals.find(a => a.id === id);
            
            const totalBet = computed(() => {
                return Object.values(bets.value).reduce((s, b) => s + b, 0);
            });

            const toastClass = computed(() => {
                if (!toast.value) return '';
                return {
                    'bg-green-600': toast.value.type === 'success',
                    'bg-red-600': toast.value.type === 'error',
                    'bg-blue-600': toast.value.type === 'info'
                };
            });

            const showToast = (msg, type) => {
                toast.value = { message: msg, type };
                setTimeout(() => toast.value = null, 3500);
            };

            const generateAIBets = () => {
                const getRandBets = () => {
                    const b = {};
                    const count = Math.floor(Math.random() * 3) + 1;
                    for(let i=0; i<count; i++) {
                        const ani = animals[Math.floor(Math.random() * 6)];
                        b[ani.id] = (Math.floor(Math.random() * 2) + 1) * betUnit;
                    }
                    return b;
                };
                ai1Bets.value = getRandBets();
                ai2Bets.value = getRandBets();
            };

            const placeBet = (id) => {
                if (gamePhase.value !== 'betting') return;
                if (balance.value < betUnit) {
                    showToast('B·∫°n kh√¥ng ƒë·ªß ti·ªÅn c∆∞·ª£c!', 'error');
                    return;
                }
                bets.value[id] = (bets.value[id] || 0) + betUnit;
                balance.value -= betUnit;
            };

            const resetBets = () => {
                balance.value += totalBet.value;
                bets.value = {};
            };

            const rollDice = () => {
                gamePhase.value = 'shaking';
                isShaking.value = true;
                
                setTimeout(() => {
                    isShaking.value = false;
                    const res = [
                        animals[Math.floor(Math.random() * 6)],
                        animals[Math.floor(Math.random() * 6)],
                        animals[Math.floor(Math.random() * 6)]
                    ];
                    diceResults.value = res;
                    gamePhase.value = 'result';
                    
                    setTimeout(() => calculateAll(res), 1200);
                }, 2000);
            };

            const calculateAll = (results) => {
                const counts = {};
                results.forEach(r => counts[r.id] = (counts[r.id] || 0) + 1);

                // T√≠nh cho Main Player
                let win = 0;
                let details = [];
                Object.entries(bets.value).forEach(([id, amount]) => {
                    if (counts[id]) {
                        const plus = amount + (amount * counts[id]);
                        win += plus;
                        details.push(`${getAnimal(id).name} x${counts[id]}`);
                    }
                });

                const profit = win - totalBet.value;
                balance.value += win;

                if (profit > 0) showToast(`B·∫†N TH·∫ÆNG: +${formatMoney(profit)}\n(${details.join(', ')})`, 'success');
                else if (profit === 0) showToast('H√íA V·ªêN!', 'info');
                else showToast(`B·∫†N THUA: -${formatMoney(Math.abs(profit))}`, 'error');

                // T√≠nh cho AI
                const calcAI = (aiBets, aiBal) => {
                    let aiWin = 0;
                    Object.entries(aiBets).forEach(([id, amount]) => {
                        if (counts[id]) aiWin += amount + (amount * counts[id]);
                    });
                    return aiWin;
                };

                ai1Balance.value += (calcAI(ai1Bets.value) - Object.values(ai1Bets.value).reduce((s, b) => s + b, 0));
                ai2Balance.value += (calcAI(ai2Bets.value) - Object.values(ai2Bets.value).reduce((s, b) => s + b, 0));

                // Reset v√°n m·ªõi
                setTimeout(() => {
                    bets.value = {};
                    diceResults.value = [];
                    gamePhase.value = 'betting';
                    generateAIBets();
                }, 3000);
            };

            onMounted(generateAIBets);

            return {
                animals, balance, ai1Balance, ai2Balance, bets, ai1Bets, ai2Bets,
                diceResults, isShaking, gamePhase, toast, totalBet,
                formatMoney, getAnimal, placeBet, resetBets, rollDice, toastClass
            }
        }
    }).mount('#app');
</script>
</body>
</html>
