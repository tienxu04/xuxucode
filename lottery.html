<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>D√≤ S·ªë Mi·ªÅn Nam @ xuxukun </title>
    <style>
        :root {
            --primary: #d32f2f;
            --secondary: #ffc107;
            --bg: #f8f9fa;
            --glass: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #b71c1c 0%, #d32f2f 100%);
            background-attachment: fixed;
            margin: 0;
            padding: 15px;
            display: flex;
            justify-content: center;
            color: #333;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 25px 20px;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h2 {
            text-align: center;
            color: var(--primary);
            margin: 0 0 20px 0;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 3px solid var(--secondary);
            display: block;
            padding-bottom: 10px;
        }

        .form-group { margin-bottom: 15px; }
        
        label { 
            display: block; 
            margin-bottom: 6px; 
            font-weight: 600; 
            font-size: 13px;
            color: #666;
            padding-left: 5px;
        }

        select, input { 
            width: 100%; 
            padding: 12px; 
            border: 1.5px solid #eee; 
            border-radius: 12px; 
            box-sizing: border-box; 
            font-size: 16px;
            background: #fff;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
            outline: none;
        }

        button { 
            width: 100%; 
            padding: 15px; 
            background: linear-gradient(to right, #d32f2f, #f44336);
            color: #fff; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3);
            margin-top: 10px;
        }

        button:active { transform: scale(0.98); }

        #status { 
            margin-top: 20px; 
            padding: 15px; 
            display: none; 
            border-radius: 12px; 
            text-align: center; 
            font-weight: 600;
        }

        .loading { background: #e3f2fd; color: #0d47a1; }
        .success { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .fail { background: #fff5f5; color: #c62828; border: 1px solid #fed7d7; }

        .lottery-table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0 8px;
            margin-top: 20px; 
            display: none; 
        }

        .lottery-table td { 
            background: #fff;
            padding: 12px 8px; 
            text-align: center; 
            font-weight: 700;
            font-size: 18px;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }

        .g-label { 
            background: #f8f8f8 !important; 
            color: #999; 
            width: 50px; 
            font-size: 11px !important; 
            border-radius: 8px 0 0 8px;
            border-left: 1px solid #eee;
        }

        .val-cell {
            border-radius: 0 8px 8px 0;
            border-right: 1px solid #eee;
        }

        .text-red { color: var(--primary); font-size: 20px !important; }
        
        .highlight { 
            background: #fff9c4 !important; 
            color: #d32f2f !important;
            border: 2px solid var(--secondary) !important;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>D√≤ S·ªë Mi·ªÅn Nam</h2>
    
    <div class="form-group">
        <label>Ng√†y quay s·ªë</label>
        <input type="date" id="dateInput">
    </div>

    <div class="form-group">
        <label>ƒê√†i quay th∆∞·ªüng</label>
        <select id="stationSelect"></select>
    </div>

    <div class="form-group">
        <label>S·ªë c·∫ßn d√≤</label>
        <input type="number" id="numInput" placeholder="Nh·∫≠p s·ªë v√© c·ªßa b·∫°n" pattern="\d*">
    </div>

    <button onclick="checkResult()" id="btnAction">D√í K·∫æT QU·∫¢</button>

    <div id="status"></div>

    <table class="lottery-table" id="resultTable">
        <tr><td class="g-label">ƒêB</td><td id="g-db" class="val-cell text-red"></td></tr>
        <tr><td class="g-label">G1</td><td id="g-1" class="val-cell"></td></tr>
        <tr><td class="g-label">G2</td><td id="g-2" class="val-cell"></td></tr>
        <tr><td class="g-label">G3</td><td id="g-3" class="val-cell"></td></tr>
        <tr><td class="g-label">G4</td><td id="g-4" class="val-cell"></td></tr>
        <tr><td class="g-label">G5</td><td id="g-5" class="val-cell"></td></tr>
        <tr><td class="g-label">G6</td><td id="g-6" class="val-cell"></td></tr>
        <tr><td class="g-label">G7</td><td id="g-7" class="val-cell"></td></tr>
        <tr><td class="g-label">G8</td><td id="g-8" class="val-cell text-red"></td></tr>
    </table>
</div>

<script>
    // C·∫≠p nh·∫≠t Slug: L√¢m ƒê·ªìng -> lam-dong, xsld
    const SLUGS = {
        'xshcm':'ho-chi-minh', 'xsdt':'dong-thap', 'xscm':'ca-mau',
        'xsbt':'ben-tre', 'xsvt':'vung-tau', 'xsbl':'bac-lieu',
        'xsdn':'dong-nai', 'xsct':'can-tho', 'xsst':'soc-trang',
        'xstn':'tay-ninh', 'xsag':'an-giang', 'xsbth':'binh-thuan',
        'xsvl':'vinh-long', 'xsbd':'binh-duong', 'xstv':'tra-vinh',
        'xsla':'long-an', 'xsbp':'binh-phuoc', 'xshg':'hau-giang',
        'xstg':'tien-giang', 'xskg':'kien-giang', 'xsld':'lam-dong'
    };

    const SCHEDULE = {
        1: [{n:'TP. H·ªì Ch√≠ Minh', c:'xshcm'}, {n:'ƒê·ªìng Th√°p', c:'xsdt'}, {n:'C√† Mau', c:'xscm'}],
        2: [{n:'B·∫øn Tre', c:'xsbt'}, {n:'V≈©ng T√†u', c:'xsvt'}, {n:'B·∫°c Li√™u', c:'xsbl'}],
        3: [{n:'ƒê·ªìng Nai', c:'xsdn'}, {n:'C·∫ßn Th∆°', c:'xsct'}, {n:'S√≥c TrƒÉng', c:'xsst'}],
        4: [{n:'T√¢y Ninh', c:'xstn'}, {n:'An Giang', c:'xsag'}, {n:'B√¨nh Thu·∫≠n', c:'xsbth'}],
        5: [{n:'Vƒ©nh Long', c:'xsvl'}, {n:'B√¨nh D∆∞∆°ng', c:'xsbd'}, {n:'Tr√† Vinh', c:'xstv'}],
        6: [{n:'TP. H·ªì Ch√≠ Minh', c:'xshcm'}, {n:'Long An', c:'xsla'}, {n:'B√¨nh Ph∆∞·ªõc', c:'xsbp'}, {n:'H·∫≠u Giang', c:'xshg'}],
        0: [{n:'Ti·ªÅn Giang', c:'xstg'}, {n:'Ki√™n Giang', c:'xskg'}, {n:'L√¢m ƒê·ªìng', c:'xsld'}]
    };

    window.onload = () => {
        const d = new Date();
        document.getElementById('dateInput').valueAsDate = d;
        updateStations(d);
    };

    document.getElementById('dateInput').onchange = (e) => {
        if(e.target.value) updateStations(new Date(e.target.value));
    };

    function updateStations(date) {
        const list = SCHEDULE[date.getDay()];
        const sel = document.getElementById('stationSelect');
        sel.innerHTML = list.map(s => `<option value="${s.c}">${s.n}</option>`).join('');
    }

    async function checkResult() {
        const num = document.getElementById('numInput').value.trim();
        const code = document.getElementById('stationSelect').value;
        const dateRaw = document.getElementById('dateInput').value;
        const btn = document.getElementById('btnAction');
        const st = document.getElementById('status');
        const table = document.getElementById('resultTable');

        if(!num) { alert("B·∫°n ch∆∞a nh·∫≠p s·ªë v√©!"); return; }

        btn.disabled = true;
        st.style.display = 'block';
        st.className = 'loading';
        st.innerText = "ƒêang l·∫•y d·ªØ li·ªáu...";
        table.style.display = 'none';

        try {
            const url = `https://xskt.com.vn/rss-feed/${SLUGS[code]}-${code}.rss`;
            const proxy = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`;
            
            const resp = await fetch(proxy);
            const xmlText = await resp.text();
            
            const parser = new DOMParser();
            const xml = parser.parseFromString(xmlText, "text/xml");
            const items = xml.querySelectorAll("item");

            const [y, m, d] = dateRaw.split('-');
            const dateFind = `${d}/${m}`; 

            let dataRaw = null;
            items.forEach(item => {
                if(item.querySelector("title").textContent.includes(dateFind)) {
                    dataRaw = item.querySelector("description").textContent;
                }
            });

            if(!dataRaw) throw new Error("Ch∆∞a c√≥ k·∫øt qu·∫£ " + dateFind);

            const prizes = parseData(dataRaw);
            displayTable(prizes);

            let wins = [];
            for(let k in prizes) {
                prizes[k].forEach(v => {
                    if(v.endsWith(num)) {
                        wins.push(k === 'db' ? 'ƒê·∫∑c Bi·ªát' : 'Gi·∫£i ' + k.toUpperCase());
                        document.getElementById('g-'+k).classList.add('highlight');
                    }
                });
            }

            st.className = wins.length ? 'success' : 'fail';
            st.innerHTML = wins.length ? `üéâ TR√öNG TH∆Ø·ªûNG!<br>${wins.join(', ')}` : "‚ùå KH√îNG TR√öNG GI·∫¢I";

        } catch (e) {
            st.className = 'fail';
            st.innerText = e.message;
        } finally {
            btn.disabled = false;
        }
    }

    function parseData(txt) {
        const parts = txt.replace(/\s+/g, ' ').split(/(ƒêB:|1:|2:|3:|4:|5:|6:|7:|8:)/);
        let res = {};
        for(let i=1; i<parts.length; i+=2) {
            let key = parts[i].replace(':','').toLowerCase();
            res[key] = parts[i+1].trim().split(/[\s-]+/).filter(s => s.length > 1);
        }
        return res;
    }

    function displayTable(data) {
        document.getElementById('resultTable').style.display = 'table';
        for(let k in data) {
            const el = document.getElementById('g-'+k);
            if(el) {
                el.innerText = data[k].join(' - ');
                el.classList.remove('highlight');
            }
        }
    }
</script>
</body>
</html>
